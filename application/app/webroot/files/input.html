<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sample</title>
</head>

<body>

<form id="form1">
	<input name="text1">
	<input type="submit">
</form>

<div id="message"></div>
<a id="back" href="./">back</a>

<script src="../js/lib/jquery.js"></script>
<script src="../js/lib/purl.js"></script>
<script>
$(function () {
	"use strict";
	var HTTP_BAD_REQUEST = 400;
	var id = $.url().param()["id"];

	if (id) {
		$.getJSON("../samples/" + id + ".json", function (data) {
			$("input[name=text1]").val(data.text1);
		});
	}

	$("#form1").on("submit", function () {
		var url = "../samples" + (id ? "/" + id : "");
		$.ajax(url, {
			type : "POST",
			data : $("#form1").serialize(),
			success : function (responseText) {
				$("#message").text(responseText);
			},
			error : function(xhr, textStatus, errorThrown) {
				if (xhr.status === HTTP_BAD_REQUEST) {
					$("#message").text(xhr.responseText);
				} else {
					alert(xhr.status + ":" + textStatus + ":" + errorThrown);
				}
			},
			complete : function () {
				$("#back").show();
			}
		});

		// デフォルト動作抑止
		return false;
	});

	$("#back").hide();
});
</script>

</body>
</html>
